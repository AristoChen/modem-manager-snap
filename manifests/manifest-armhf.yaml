snapcraft-version: 7.5.2
snapcraft-started-at: '2023-08-21T08:37:14.780044Z'
snapcraft-os-release-id: ubuntu
snapcraft-os-release-version-id: '22.04'
name: modem-manager
version: 1.20.0-2
summary: ModemManager is a service which controls mobile broadband
description: |
  ModemManager is a DBus-activated daemon which controls mobile broadband
  (2G/3G/4G) devices and connections. Whether built-in devices, USB dongles,
  bluetooth-paired telephones or professional RS232/USB devices with external
  power supplies, ModemManager is able to prepare and configure the modems and
  setup connections with them.
  Please find the source code at
  https://code.launchpad.net/~snappy-hwe-team/snappy-hwe-snaps/+git/modem-manager/+ref/snap-22
base: core22
grade: stable
confinement: strict
apps:
  mmcli:
    command: bin/mmcli
    plugs:
    - mmcli
  modemmanager:
    command: bin/modemmanager
    daemon: simple
    slots:
    - service
  mbimcli:
    command: usr/bin/mbimcli
    slots:
    - service
  mbim-network:
    command: usr/bin/mbim-network
    slots:
    - service
  qmicli:
    command: usr/bin/qmicli
    slots:
    - service
  qmi-network:
    command: usr/bin/qmi-network
    slots:
    - service
parts:
  modemmanager-hooks:
    plugin: dump
    source: hooks
    organize:
      configure: meta/hooks/configure
    stage-packages: []
    stage: []
    prime: []
    build-packages: []
  modemmanager-bin:
    plugin: dump
    source: bin
    organize:
      modemmanager: bin/modemmanager
      mmcli: bin/mmcli
      mmcli-internal: bin/mmcli-internal
    stage-packages: []
    stage: []
    prime: []
    build-packages: []
  changelog:
    plugin: nil
    override-build: 'cp "/build/ci-modem-manager-rrr7aamv3xld9o1p"/ChangeLog "$CRAFT_PART_INSTALL"

      '
    organize:
      ChangeLog: snap/ChangeLog
    stage-packages: []
    stage: []
    prime: []
    build-packages: []
  stack-snaps-tools:
    plugin: nil
    source: https://git.launchpad.net/~snappy-hwe-team/snappy-hwe-snaps/+git/stack-snaps-tools
    source-type: git
    build-packages:
    - dpkg-dev
    - git
    stage-packages:
    - libgudev-1.0-0=1:237-2build1
    - libmbim-glib4=1.28.0-1~ubuntu20.04.1
    - libmbim-proxy=1.28.0-1~ubuntu20.04.1
    - libmm-glib0=1.20.0-1~ubuntu22.04.2
    - libpolkit-agent-1-0=0.105-33
    - libqmi-glib5=1.32.0-1ubuntu0.22.04.1
    - libqmi-proxy=1.32.0-1ubuntu0.22.04.1
    - modemmanager=1.20.0-1~ubuntu22.04.2
    - pkexec=0.105-33
    - policykit-1=0.105-33
    - polkitd=0.105-33
    override-build: |
      set -ex
      find "$CRAFT_PART_INSTALL"/ -type f,l \
                -not -path "$CRAFT_PART_INSTALL"/'usr/share/doc/modemmanager*' \
           -and -not -path "$CRAFT_PART_INSTALL"/'usr/share/doc/libmm-glib0*' \
           -delete
      find "$CRAFT_PART_INSTALL"/ -type d -empty -delete
      mkdir -p "$CRAFT_PART_INSTALL"/build-tools
      cp build-tools/* "$CRAFT_PART_INSTALL"/build-tools
    prime:
    - usr/share/doc/modemmanager
    - usr/share/doc/libmm-glib0
    stage: []
  modemmanager:
    plugin: autotools
    after:
    - stack-snaps-tools
    source: https://git.launchpad.net/ubuntu/+source/modemmanager
    source-type: git
    source-branch: applied/ubuntu/jammy-updates
    autotools-configure-parameters:
    - --prefix=/usr
    - --libdir=/usr/lib
    - --libexecdir=/usr/lib/ModemManager
    - --sysconfdir=/etc
    - --enable-gtk-doc=no
    - --with-polkit=no
    - --enable-vala=no
    - --disable-maintainer-mode
    - CFLAGS='-O2 -Wl,-z,relro,-z,now -pie -fpie'
    build-packages:
    - autoconf-archive
    - intltool
    - gtk-doc-tools
    - libdbus-glib-1-dev
    - libdbus-1-dev
    - libiw-dev
    - libglib2.0-dev
    - libnl-3-dev
    - libnl-route-3-dev
    - libnl-genl-3-dev
    - libnss3-dev
    - libgnutls28-dev
    - libxml-parser-perl
    - uuid-dev
    - libsystemd-dev
    - libudev-dev
    - libgudev-1.0-dev
    - libgirepository1.0-dev
    - gobject-introspection
    - libsoup2.4-dev
    - libglib2.0-doc
    - libmm-glib-dev
    - libndp-dev
    - libreadline-dev
    - libnewt-dev
    - dbus-test-runner
    - python3-dbus
    - python3-gi
    - libqmi-glib-dev
    - libmbim-glib-dev
    stage-packages:
    - libgudev-1.0-0=1:237-2build1
    - libmbim-glib4=1.28.0-1~ubuntu20.04.1
    - libmbim-proxy=1.28.0-1~ubuntu20.04.1
    - libmbim-utils=1.28.0-1~ubuntu20.04.1
    - libqmi-glib5=1.32.0-1ubuntu0.22.04.1
    - libqmi-proxy=1.32.0-1ubuntu0.22.04.1
    - libqmi-utils=1.32.0-1ubuntu0.22.04.1
    override-build: |
      set -ex
      "/build/ci-modem-manager-rrr7aamv3xld9o1p/stage"/build-tools/check-versions modemmanager
      # Apply snap related patches
      git config user.email "snapcraft@canonical.com"
      git config user.name "snapcraft"
      git am "/build/ci-modem-manager-rrr7aamv3xld9o1p"/patch/*.patch
      # Build (rename .git so configure sets release flag)
      mv .git git
      craftctl default
      # Run all tests ModemManager ships by default
      make check
      mv git .git
      # Strip binaries
      find "$CRAFT_PART_INSTALL"/ -executable -type f | xargs file -Ni |
          grep 'application/x-.*executable\|application/x-.*sharedlib' | cut -d: -f1 | xargs strip
    prime:
    - usr/bin/mmcli
    - usr/sbin/ModemManager
    - usr/lib/ModemManager/*so
    - usr/lib/*/libgudev-1.0.so*
    - usr/lib/libmm-glib.so*
    - usr/share/doc/libgudev-1.0-0
    - usr/lib/*/libmbim-glib.so*
    - usr/bin/mbimcli
    - usr/bin/mbim-network
    - usr/share/doc/libmbim-glib4
    - usr/share/doc/libmbim-proxy
    - usr/share/doc/libmbim-utils
    - usr/lib/*/libqmi-glib.so*
    - usr/bin/qmicli
    - usr/bin/qmi-firmware-update
    - usr/bin/qmi-network
    - usr/share/doc/libqmi-glib5
    - usr/share/doc/libqmi-proxy
    - usr/share/doc/libqmi-utils
    - usr/libexec/*
    stage: []
architectures:
- armhf
image-info:
  build_url: https://launchpad.net/~snappy-hwe-team/+snap/ci-modem-manager-rrr7aamv3xld9o1p/+build/2206711
build-packages: []
build-snaps: []
primed-stage-packages:
- libgudev-1.0-0=1:237-2build1
- libmbim-glib4=1.28.0-1~ubuntu20.04.1
- libmbim-proxy=1.28.0-1~ubuntu20.04.1
- libmbim-utils=1.28.0-1~ubuntu20.04.1
- libmm-glib0=1.20.0-1~ubuntu22.04.2
- libqmi-glib5=1.32.0-1ubuntu0.22.04.1
- libqmi-proxy=1.32.0-1ubuntu0.22.04.1
- libqmi-utils=1.32.0-1ubuntu0.22.04.1
- modemmanager=1.20.0-1~ubuntu22.04.2
